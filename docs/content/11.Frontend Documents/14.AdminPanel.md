# AdminPanel, a multifunkcionális adminisztrátori felület.

> **Komponens célja:** egységes admin/operátori felület a foglalások (**reservations**) és a vásárlások (**purchases**) listázására, szűrésére, szerkesztésére és törlésére, reszponzív felépítéssel (mobil kártyák és asztali táblázat), PrimeVue Paginatorral, valamint lehetőséget nyújt akár moziműsor létrehozására, vagy film adatainak módosítására.

---

## Tartalomjegyzék

1. [Technológiák és függőségek](#technológiák-és-függőségek)
2. [Fájl/Komponens áttekintés](#fájlkomponens-áttekintés)
3. [Adatmodellek és adattárolás](#adatmodellek-és-adattárolás)
4. [Reaktív állapot és computed értékek](#reaktív-állapot-és-computed-értékek)
5. [Szűrési logika](#szűrési-logika)
6. [Lapozás (Paginator)](#lapozás-paginator)
7. [További adminisztrátori funkciók](#további-adminisztrátori-funkciók)
8. [Nézetek és reszponzív viselkedés](#nézetek-és-reszponzív-viselkedés)
9. [Szerkesztési és törlési folyamat](#szerkesztési-és-törlési-folyamat)
10. [Hibakezelés és visszajelzés](#hibakezelés-és-visszajelzés)
11. [Hozzáférhetőség (a11y) és i18n](#hozzáférhetőség-a11y-és-i18n)
12. [Teljesítmény és minőségbiztosítás](#teljesítmény-és-minőségbiztosítás)
13. [Ismert inkonzisztenciák / javítási javaslatok](#ismert-inkonzisztenciák--javítási-javaslatok)
14. [Tesztelési javaslatok](#tesztelési-javaslatok)
15. [Bővíthetőség és refaktorálás](#bővíthetőség-és-refaktorálás)
16. [API-szerződés (store-módszerek)](#api-szerződés-store-módszerek)
17. [Minták és kódrészletek](#minták-és-kódrészletek)

---

## Technológiák és függőségek

* **Vue 3** (Composition API, `<script setup>`)
* **Pinia** store-ok: `useTicketStore`, `useMovieStore`
* **PrimeVue**: `Paginator`
* **Tailwind CSS** utility osztályok
* **Egyedi Toast szolgáltatás**: `ToastService`

---

## Fájl/Komponens áttekintés

A komponens két fő nézetet kezel:

* **Foglalási áttekintő** (`viewMode === 'reservations'`)
* **Vásárlási áttekintő** (`viewMode === 'purchases'`)

A **szűrősáv** (helyszín, film, email) minden nézetben közös. Az oldal bővülködik egy **lapozós listával**, mely tablet *(md)* és asztali *(lg)* nézeten elérhető.

Mobilon kártyás elrendezés látható, asztali nézetben táblázat.

Az adatok a Pinia store-okból érkeznek:

* `ticketStore.reservations` és `ticketStore.purchases`
* `movieStore.movies`

Az élesítési pont a `onMounted` hook, amely lehívja a szükséges store-metódusokat.

---

## Adatmodellek és adattárolás

**Források:** Pinia store-ok (külső API/Backend felé ezek a store-ok fognak kommunikálni).

### ReservationResource

* `id: number`
* `location_id: number` → megjelenítés: `locationNames[location_id]`
* `userEmail?: string` / `user?.email?: string` / `guest_email?: string`
* `movieTitle?: string`
* `parkingspot: string | number` (helyjegyek darabszám / azonosítók)
* `confirmation?: string` (foglalási azonosító)

### PurchaseResource

* `id: number`
* `location_id: number`
* `userEmail?: string` / `guest_email?: string`
* `movieTitle?: string`
* `parkingspot: string | number`
* `ticket_code?: string` (vásárlási azonosító)

---

## Reaktív állapot és computed értékek

* `viewMode: 'reservations' | 'purchases'` – aktív nézet
* `emailFilter: string` – szabad szöveges szűrés e-mailre
* `selectedMovie: string` – filmszűrés pontos cím egyezéssel
* `selectedLocation: string` – helyszín szűrés (név szerinti, pontos egyezéssel)
* `editingDataId: number | null` – szerkesztett sor/kártya azonosítója
* `editableData: Record<string, any>` – lokális szerkesztési puffer (kétirányú kötés inputoknál)

**Származtatott értékek:**

* `filteredItems`: az aktív nézet elemei a három szűrő alkalmazása után
* `currentPage`, `rows`, `paginatedItems`: kliens oldali lapozás (csak asztali és tablet nézetben használatos)

---

## Szűrési logika

A `filteredItems` a következő lépésekben szűr:

1. **Forráslista kiválasztása** a `viewMode` alapján: `reservations` vagy `purchases`.
2. **Helyszín**: pontos név egyezés, kisbetűsítve (pl. `locationNames[r.location_id] === selectedLocation`).
3. **Film**: pontos cím egyezés, kisbetűsítve (pl. `(r.movieTitle || '') === selectedMovie`).
4. **E-mail**: részsztring keresés, kisbetűsítve (pl. `email.includes(emailFilter)`).

---

## Lapozás (Paginator)

* **PrimeVue Paginator**: `rows`, `totalRecords`, `rowsPerPageOptions` (10/20/30).
* Esemény: `@page="onPage"` → frissíti a `currentPage` és `rows` értékeket.
* **Kliens oldali lapozás**: `paginatedItems` az `filteredItems` szelete.

---

## További adminisztrátori funkciók

A lapozó alatt két admin panel váltható meg: filmadatok szerkesztése és új vetítés létrehozása. Mindkettő eseményekkel kommunikál a store-okkal és a szülő AdminPanellel.

- ***AdminMovieUpdatePanel***

  - **Cél:** Filmek listázása és teljes körű szerkesztése (cím, leírás, típus, korhatár, megjelenés, rendező, hossz, poszter, premier).

  - **Fő műveletek:** betöltés → inline szerkesztés → mentés (movieStore.updateMovie) → törlés (movieStore.deleteMovie) → toast visszajelzés.

- **CreateScreeningComponent**:
  - **Cél:** Új vetítések létrehozása (film, dátum/idő, terem/helyszín, kapacitás, jegyár, flags).

  - **Fő műveletek:** filmválasztó → időpont/terem beállítása → duplikáció-ellenőrzés → létrehozás (screeningStore.create) → success emit.

---

## Nézetek és reszponzív viselkedés

* **Mobil és tablet (< lg)**: kártyák (külön markup **reservations** és **purchases** esetén).
* **Asztali (≥ lg)**: táblázatok (külön markup **reservations** és **purchases** esetén).
* **Szűrősáv**: grid (1 oszlop mobilon, 4 oszlop md-től), tartalmazza a helyszínt, filmet, e-mail szűrőt és a nézetváltó gombokat.

---

## Szerkesztési és törlési folyamat

**Indítás:** `startEdit(item)` → `editingReservationId = item.id`, `editableData = { ...item }`.

**Mentés:**

* Foglalás: `handleUpdateReservation(id)` → `ticketStore.updateReservation(id, editableData)` → reset + `ticketStore.getReservations()`
* Vásárlás: `handleUpdatePurchase(id)` → `ticketStore.updatePurchase(id, editableData)` → reset + `ticketStore.getPurchases()`

**Törlés:**

* Foglalás: `handleDeleteReservation(id)` → `ticketStore.deleteReservation(id)`
* Vásárlás: `handleDeletePurchase(id)` → `ticketStore.deletePurchase(id)`

**UI állapot:** amíg szerkesztésben van egy sor, csak **Mentés** gomb látszik az adott elemnél; egyébként „Módosítás” és „Törlés”.

---

## Hibakezelés és visszajelzés

* Sikeres műveleteknél: `ToastService.showSuccess(...)`
* Hibáknál: `ToastService.showError(...)` vagy `console.error`
* Ütközési példa: „A módosítani kívánt hely már foglalt!” – backendből érkező domain-hiba esetén.

---

## API (store-módszerek)

A komponens a következő store metódusokra támaszkodik (feltételezett szerződés):

* `ticketStore.getReservations(): Promise<void>` – feltölti `reservations`-t
* `ticketStore.getPurchases(): Promise<void>` – feltölti `purchases`-t
* `ticketStore.updateReservation(id: number, payload: Partial<Reservation>): Promise<void>`
* `ticketStore.updatePurchase(id: number, payload: Partial<Purchase>): Promise<void>`
* `ticketStore.deleteReservation(id: number): Promise<void>`
* `ticketStore.deletePurchase(id: number): Promise<void>`
* `movieStore.getMovies(): Promise<void>` – feltölti `movies`

---

## Minták és kódrészletek

### 1) Film cím megjelenítése mobil kártyákon

```vue
<p class="font-semibold pl-2">Film: <span class="px-2">{{ reservation.movieTitle || 'Ismeretlen' }}</span></p>
```

### 2) Paginator egységesítése foglalásoknál is

```vue
<tr v-for="reservation in paginatedItems" :key="reservation.id"> ... </tr>
```

### 3) Semleges szerkesztési azonosító

```js
const editingItemId = ref<number | null>(null)
```

### 4) „Tartalmazza” típusú filmszűrés

```js
if (selectedMovie.value) {
  const q = selectedMovie.value.toLowerCase()
  items = items.filter(r => (r.movieTitle || '').toLowerCase().includes(q))
}
```
