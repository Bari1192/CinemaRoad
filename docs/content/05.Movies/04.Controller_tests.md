# Movie Controller Tesztesetei

Ez a dokumentum a `MovieController` HTTP végpontjainak funkcionális tesztelését írja le a Laravel PHPUnit tesztelési keretrendszerrel. A tesztek a TDD (Test-Driven Development) elvek szerint íródtak, szigorúan betartva az "egy assert per teszt" és "egy egység tesztelése" szabályokat.

## Teszt Fájl Helye

`tests/Feature/MovieApiTest.php`

## Teszt Metódusok

### 1. GET /api/movies (index metódus)

-   **Cél**: Az összes film adatainak sikeres lekérése.
-   **Teszt metódusok**:
  
    1.  **`it_returns_successful_response_for_getting_all_movies()`**
        *   **Elvárt eredmény**: HTTP válasz státusz: `200 OK`.
  
    2.  **`it_returns_data_key_when_getting_all_movies()`**
        *   **Elvárt eredmény**: A JSON válasz tartalmazza a `data` gyökérkulcsot.
  
    3.  **`it_returns_non_empty_data_array_when_getting_all_movies()`**
        *   **Elvárt eredmény**: A `data` tömb nem üres (ha vannak filmek az adatbázisban).

### 2. POST /api/movies (store metódus)

-   **Cél**: Új film létrehozása az adatbázisban.
-   **Adat Példa**:

    ```json
    {
      "title": "Test Movie Title",
      "description": "This is a test movie description.",
      "duration_min": 120,
      "poster_url": "http://example.com/poster.jpg"
    }
    ```

-   **Teszt metódusok**:

    1.  **`it_returns_successful_response_when_creating_a_movie()`**
        *   **Elvárt eredmény**: HTTP válasz státusz: `201 Created`.

    2.  **`it_stores_movie_in_database_when_creating_it()`**
        *   **Elvárt eredmény**: Az adatbázis tartalmazza az új rekordot a megfelelő adatokkal.

    3.  **`it_returns_correct_json_structure_after_creating_movie()`**
        *   **Elvárt eredmény**: A JSON válasz struktúrája megfelel a `MovieResource` által elvártnak (id, title, description, duration_min, poster_url, created_at, updated_at).

    4.  **`it_returns_movie_data_with_correct_title_after_creating_it()`**
        *   **Elvárt eredmény**: A JSON válaszban szerepel a helyesen létrehozott film címe.

### 3. GET /api/movies/{id} (show metódus)

-   **Cél**: Egy adott film adatainak lekérése ID alapján.

-   **Teszt metódusok**:
    1.  **`it_returns_successful_response_for_showing_a_movie()`**
        *   **Elvárt eredmény**: HTTP válasz státusz: `200 OK`.

    2.  **`it_returns_correct_movie_title_when_showing_a_movie()`**
        *   **Elvárt eredmény**: A JSON válaszban szerepel a helyes film címe.

    3.  **`it_returns_correct_json_structure_when_showing_a_movie()`**
        *   **Elvárt eredmény**: A JSON válasz struktúrája megfelel a `MovieResource` által elvártnak.

    4.  **`it_returns_404_when_showing_a_non_existent_movie()`**
        *   **Elvárt eredmény**: HTTP válasz státusz: `404 Not Found`, ha a film nem létezik.

### 4. PUT /api/movies/{id} (update metódus)

-   **Cél**: Létező film adatainak módosítása.

-   **Adat Példa**:
    ```json
    {
      "title": "Updated Movie Title",
      "duration_min": 150
    }
    ```
-   **Teszt metódusok**:

    1.  **`it_returns_successful_response_when_updating_an_existing_movie()`**
        *   **Elvárt eredmény**: HTTP válasz státusz: `200 OK`.

    2.  **`it_updates_movie_data_in_database()`**
        *   **Elvárt eredmény**: Az adatbázis tartalmazza a frissített rekordot.

    3.  **`it_returns_correct_json_structure_after_updating_movie()`**
        *   **Elvárt eredmény**: A JSON válasz struktúrája megfelel a `MovieResource` által elvártnak.

    4.  **`it_returns_updated_movie_data_after_updating_it()`**
        *   **Elvárt eredmény**: A JSON válaszban szerepel a frissített film címe.

    5.  **`it_returns_404_when_updating_a_non_existent_movie()`**
        *   **Elvárt eredmény**: HTTP válasz státusz: `404 Not Found`, ha a film nem létezik.

### 5. DELETE /api/movies/{id} (destroy metódus)

-   **Cél**: Létező film rekord törlése az adatbázisból.
-   **Teszt metódusok**:

    1.  **`it_returns_successful_response_when_deleting_a_movie()`**
        *   **Elvárt eredmény**: HTTP válasz státusz: `204 No Content`.

    2.  **`it_removes_movie_from_database_after_deleting_it()`**
        *   **Elvárt eredmény**: Az adatbázis nem tartalmazza a törölt rekordot.

    3.  **`it_returns_404_when_deleting_a_non_existent_movie()`**
        *   **Elvárt eredmény**: HTTP válasz státusz: `404 Not Found`, ha a film nem létezik.

### 6. Validációs Tesztek (POST/PUT)

-   **Cél**: Annak ellenőrzése, hogy a `StoreMovieRequest` és `UpdateMovieRequest` validációs szabályai megfelelően működnek.
-   **Teszt metódusok (Példák)**:

    1.  **`it_returns_422_when_creating_movie_without_title()`**
        *   **Elvárt eredmény**: HTTP válasz státusz: `422 Unprocessable Entity` (ha a `title` hiányzik).

    2.  **`it_returns_422_when_creating_movie_with_too_long_title()`**
        *   **Elvárt eredmény**: HTTP válasz státusz: `422 Unprocessable Entity` (ha a `title` meghaladja a 255 karaktert).

    3.  **`it_returns_422_when_creating_movie_with_negative_duration()`**
        *   **Elvárt eredmény**: HTTP válasz státusz: `422 Unprocessable Entity` (ha a `duration_min` negatív).

    4.  **`it_returns_422_when_updating_movie_with_too_long_title()`**
        *   **Elvárt eredmény**: HTTP válasz státusz: `422 Unprocessable Entity` (update esetén, ha a `title` meghaladja a 255 karaktert).

    5.  **`it_returns_422_when_updating_movie_with_negative_duration()`**
        *   **Elvárt eredmény**: HTTP válasz státusz: `422 Unprocessable Entity` (update esetén, ha a `duration_min` negatív).

---