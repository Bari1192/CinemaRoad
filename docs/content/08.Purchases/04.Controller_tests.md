# Purchase Controller Tesztesetei

Ez a dokumentum a `PurchaseController` HTTP végpontjainak funkcionális tesztelését írja le a Laravel PHPUnit tesztelési keretrendszerrel.  
A tesztek célja a felhasználói (`user`) és vendég (`guest`) vásárlások teljes körű ellenőrzése, ideértve a rekordok adatbázisba kerülését és a JSON-válaszok struktúráját.

## Teszt Fájl Helye

`tests/Feature/Http/Controllers/PurchaseControllerTest.php`

## Teszt Metódusok

### 1. GET /api/purchases (index metódus)

- **Cél**: Az összes vásárlás adatainak lekérése.
- **Teszt metódus**:
    1. **`test_can_get_purchases()`**  
       * **Elvárt eredmény**: HTTP válasz státusz `200 OK`.

---

### 2. POST /api/purchases – Felhasználói vásárlás

- **Cél**: Bejelentkezett felhasználó vásárlásának rögzítése.

- **Adat példa**:
    ```json
    {
      "location_id": 1,
      "movie_id": 1,
      "screening_id": 1,
      "parkingspot": "A1",
      "user_id": 1
    }
    ```

- **Teszt metódusok**:
    1. **`test_user_can_post_purchase()`**  
       * **Elvárt eredmény**: HTTP státusz `201 Created`.

    2. **`test_user_purchase_is_in_database()`**  
       * **Elvárt eredmény**: Az adatbázis tartalmazza a megadott adatokat.

    3. **`test_user_purchase_json_structure_correct()`**  
       * **Elvárt eredmény**: A JSON-válasz tartalmazza az elvárt kulcsokat:
         ```
         id, location_id, screening_id, movie_id, ticket_code, guest_email, parkingspot, created_at, updated_at
         ```

---

### 3. POST /api/purchases – Vendég vásárlás

- **Cél**: Vendég felhasználó vásárlásának rögzítése.

- **Adat példa**:
    ```json
    {
      "location_id": 1,
      "movie_id": 1,
      "screening_id": 1,
      "parkingspot": "A1",
      "guest_email": "guestTestEmail@gmail.com"
    }
    ```

- **Teszt metódusok**:
    1. **`test_guest_can_post_purchase()`**  
       * **Elvárt eredmény**: HTTP státusz `201 Created`.

    2. **`test_guest_purchase_is_in_database()`**  
       * **Elvárt eredmény**: Az adatbázis tartalmazza a megadott adatokat.

    3. **`test_guest_purchase_json_structure_correct()`**  
       * **Elvárt eredmény**: A JSON-válasz tartalmazza az elvárt kulcsokat:
         ```
         id, location_id, screening_id, movie_id, ticket_code, guest_email, parkingspot, created_at, updated_at
         ```

---

## Megjegyzések

- A tesztek **`DatabaseTransactions`** trait-et használnak, így minden teszt végén az adatbázis visszaáll eredeti állapotába.
- A felhasználói és vendég vásárlás külön tesztelve van a kód tisztasága és az egyértelmű hibakeresés érdekében.
- Az egyes teszt metódusok **egy** logikai egységet vizsgálnak (egy assert per teszt elv).
