# CreateScreeningDay, a vetítésnap létrehozó admin felület.

> **Komponens célja:** *egy* egységesített adminisztrátori felület, vetítések (**screenings**) létrehozására, reszponzív felépítéssel (mobil kártyák és asztali táblázat).

> Megjegyzés: A komponens az ***AdminPanel*** oldalon elérhető.
---

## Tartalomjegyzék

1. [Technológiák és függőségek](#technológiák-és-függőségek)
2. [Fájl áttekintés](#fájl-áttekintés)
3. [Adatmodellek és tárolás](#adatmodellek-és-tárolás)
4. [Reaktív állapot és számított(computed) értékek](#reaktív-állapot-és-számítottcomputed-értékek)
5. [Vetítések mentési folyamata](#vetítések-mentési-folyamata)
6. [Visszajelzések](#visszajelzések)
7. [API (store-módszerek)](#api-store-módszerek)

---

## Technológiák és függőségek
* **Vue 3**: (Composition API, `<script setup>`)
* **Pinia**: store-ok: `useScreeningStore`, `useUserStore`, `useDriveInCinemaStore`, `useMovieStore`
* **Tailwind CSS**: utility osztályok
* **Egyedi Toast szolgáltatás**: `ToastService`

---

## Fájl áttekintés

* **Helyszínválasztó legördülő lista**: Az elérhető autósmozik közül választhatunk.
* **Dátumválasztó mező**: A vetítés napjának kiválasztására szolgál.
* **Filmválasztó legördülő lista**: Több film hozzárendelése a kiválasztott naphoz.
* **"Összeállítás újrakezdése" gomb**: ***Egy*** darab film kiválasztása után lesz elérhető, kiüríti az addig kiválasztott filmeket.
* **"Vetítési nap mentése" gomb**: ***Négy*** darab film kiválasztása után lesz elérhető, kattintásra az összeállított moziműsor elmentésre kerül a rendszerbe.

---

## Adatmodellek és tárolás

**Források:** Pinia store-ok (külső API/Backend felé ezek a store-ok fognak kommunikálni).

### StoreReservationRequest
* `movie_id`
* `drive_in_cinema_id`
* `start_time`

* Adatmentési logika:
> Promise mentési logika
```js
await Promise.all(selectedMovies.value.map((movieId, i) => {
        if (!movieId) return;
        return screeningStore.createScreening({
            movie_id: movieId,
            drive_in_cinema_id: selectedCinema.value.id,
            start_time: `${datePrefix} ${startTimes.value[i]}:00`
        });
    }));
```

---

## Reaktív állapot és számított(computed) értékek
### Állapotok
* `selectedMovies:` – Kiválasztott filmek. Értékeit a template-ből származó legördülőlista állítja.
* `isOpen:` – Mozihelyszín kiválasztásánál szerepet játszó változó. Állításával a legördülőlista eltűnik illetve megmutatkozik.
* `selectedValue: ` – Értéke a helyszín kiválasztását követően állítódik.
* `router: ` – Oldal levédése érdekében. Kizárólag csak admin ranggal ellátott személyek látogathatják az oldalt.
* `selectedDate:` – Dátum kiválasztása után kerül az értéke beállításra.
* `screeningsArray:` – onMounted hook-on belül kerül feltöltésre, a friss vetítések érdekében.
* `baseStart` - A megjelenített film kártyák, és vetítési idejük kiszámításához fontos szerepet játszó változó.
* `maxScreeningsPerDay` - Dátumválasztó mező védése érdekében kinyílvánított napi maximális vetítési szám.
* `startTimes` - A vetítések létrehozása érdekében létrehozott tömb, mely tárolja a létrehozni kívánt vetítési időpontokat.

### Számított(computed) értékek:
* `selectedMovieObjects` - A kiválasztott filmek **(selectedMovies)** és a **movieStore.movies** tároló segítségével összeállított számított érték.
* `selectedCinema` - Kiválasztott mozihelyszín esetén kerül frissítésre. Segítségére a **driveInCinemaStore.driveInCinemas** szolgál.
* `minDate` - Megkeresi azt a napot, melyen nincs vetítés, ezáltal biztos terepet nyújtva az adminnak vetítési nap létrehozása érdekében.

---

## Vetítések mentési folyamata

* **Helyszínválasztás** - `selectCinema(cinema)` -> `selectedCinema` -> `selectedCinema.value.id`
* **Dátum választása** - `selectedDate` -> `datePrefix` -> `start_time` 
* **Filmek összetétele** - `selectedMovies` -> **await Promise.all(selectedMovies.value.map((movieId, i) => ...)**

* **UI állapot:** A filmet kedvünk szerint cserélhetjük a legördülő listából. Számított mezőik ettől függetlenül, dinamikusan újraszámítódnak. A vetítések a "Vetítések mentése" gombra kattintva kerülnek a rendszerbe.

---

## Visszajelzések

* Sikeres műveleteknél: `ToastService.showSuccess(...)`

---

## API (store-módszerek)

A komponens a következő store metódusokra támaszkodik (feltételezett szerződés):

* `userStore.getUser(): Promise<void>` – lekéri a felhasználót.
* `movieStore.getMovies(): Promise<void>` – feltölti `movies`-t.
* `driveInCinemaStore.getDriveInCinemas(): Promise<void>` - feltölti a `driveInCinemaStore.driveInCinemas`-t.
* `screeningStore.getScreenings(): Promise<void>` - lekéri az összes vetítést.
* `ticketStore.deleteReservation(id: number): Promise<void>`

