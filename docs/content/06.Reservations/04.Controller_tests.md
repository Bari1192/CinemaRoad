# Reservations Controller Tesztesetei

Ez a dokumentum a `ReservationsController` HTTP végpontjainak funkcionális tesztelését írja le a Laravel PHPUnit tesztelési keretrendszerrel.  
A tesztek célja az API működésének és validációs szabályainak ellenőrzése, TDD szemléletben.

## Teszt Fájl Helye

`tests/Feature/Http/Controllers/ReservationsControllerTest.php`

## Teszt Metódusok

### 1. GET /api/reservations (index metódus)

- **Cél**: Az összes foglalás adatainak sikeres lekérése.
- **Teszt metódus**:
  1. **`test_can_get_reservations()`**
     * **Elvárt eredmény**: HTTP válasz státusz: `200 OK`.

---

### 2. POST /api/reservations (store metódus)

- **Cél**: Új foglalás létrehozása az adatbázisban.
- **Adat Példa**:
    ```json
    {
      "user_id": 1,
      "screening_id": 10,
      "location_id": 1,
      "reserved_at": "2025-08-14",
      "parkingspot": "G8"
    }
    ```

- **Teszt metódusok**:
  1. **`test_can_post_reservation()`**
     * **Elvárt eredmény**: HTTP válasz státusz: `201 Created`.
  
  2. **`test_created_reservation_is_in_database()`**
     * **Elvárt eredmény**: Az adatbázis tartalmazza a létrehozott rekordot a megadott adatokkal.

  3. **`test_reservation_json_structure_is_correct()`**
     * **Elvárt eredmény**: A JSON válasz szerkezete tartalmazza a `data` kulcsot az alábbi mezőkkel:
        - `id`
        - `user_id`
        - `screening_id`
        - `location_id`
        - `parkingspot`
        - `reserved_at`
        - `created_at`

---

### 3. Validációs Tesztek (POST)

- **Cél**: Annak ellenőrzése, hogy a foglalás létrehozása során a validációs szabályok megfelelően működnek.
- **Teszt metódusok**:
  
  1. **`test_can_not_post_reservation_with_non_existent_user_id()`**
     * **Elvárt eredmény**: HTTP válasz státusz: `422 Unprocessable Entity` (nem létező `user_id` esetén).
  
  2. **`test_can_not_post_reservation_without_user_id()`**
     * **Elvárt eredmény**: HTTP válasz státusz: `422 Unprocessable Entity` (`user_id` hiányában).
  
  3. **`test_can_not_post_reservation_with_invalid_reserved_at_field()`**
     * **Elvárt eredmény**: HTTP válasz státusz: `422 Unprocessable Entity` (hibás dátumformátum esetén).

---

### 4. Üzleti Logika Tesztek

- **Cél**: Annak ellenőrzése, hogy egy parkolóhelyet egyszerre csak egy foglalás foglalhasson le.
- **Teszt metódus**:
  
  1. **`test_can_not_book_another_reservation_to_the_same_parkingspot()`**
     * **Elvárt eredmény**: HTTP válasz státusz: `422 Unprocessable Entity`, ha a parkolóhelyet már lefoglalták az adott időpontra.

---
