# `useDriveInCinemaStore` - Pinia Store Dokumentáció

## 1 | Áttekintés
Ez a dokumentum a `useDriveInCinemaStore` Pinia Store-t írja le, amely a CinemaRoad projekt **frontend oldalán** a vetítésekkel kapcsolatos **adatok kezeléséért felelős**.  

A Store a Pinia `defineStore` függvényével jön létre, `driveInCinemas` azonosítóval.

- két reaktív állapotot tart fenn (`driveInCinemaStores`, `driveInCinemaStore`);

- teljes körű **CRUD** műveleteket biztosít (`getScreenings`, `getScreening`, `createScreening`, `updateScreening`, `deleteScreening`);

- egységes hibakezelést valósít meg `try/catch` blokkokkal.

```mjs
    import { ref } from 'vue'
    import { http } from '@utils/http.mjs'

    export const useScreeningStore = defineStore('screenings', ()     => {
      const screenings = ref([])
      const screening  = ref(null)

      async function getDriveInCinemas()
      async function getDriveInCinema(id)
      async function createDriveInCinema(data)
      async function updateDriveInCinema(id, data)
      async function deleteDriveInCinema(id)

      return {
        driveInCinemas,
        driveInCinema,

        getdriveInCinemas,
        getdriveInCinema,
        createDriveInCinema,
        updateDriveInCinema,
        deleteDriveInCinema
      }
    })
```

---
## 2 | Függőségek

## Függőségek

*   `vue` (ref)
*   `pinia` (defineStore)
*   `@utils/http.mjs` (http kliens, axios alapokra építve.)


| Csomag           | Verzió | Szerep                                        |
|------------------|--------|----------------------------------------------|
| `pinia`          | 2.x    | Állapotkezelés                                |
| `axios`          | 1.x    | REST-hívások                                  |
| `vue-router`     | 4.x    | Útválasztás + út-őrség                        |
| `vitest`         | ^1     | Unit-tesztek                                  |
| `laravel/framework` | 11.x | Backend REST-API + feature tesztek           |

## 3 | Állapot (state)
| Változó                | Típus              | Default      | Leírás |
|------------------------|--------------------|--------------|--------|
| `cinemas`              | `DriveInCinema[]`  | `[]`         | Teljes lista |
| `selectedCinema`       | `DriveInCinema?`   | `null`       | Egy adott mozi |
| `loading`              | `boolean`          | `false`      | Globális betöltés-jelző |
| `error`                | `string \| null`   | `null`       | Ember-barát hibaüzenet |

## 4 | CRUD akciók

| Művelet | Függvény | HTTP | Végpont | Params | Oldja a state-et | Kód-kivonat |
|---------|----------|------|---------|--------|------------------|-------------|
| **L – Listázás** | `fetchCinemas()` | GET | `/` | – | `cinemas[]` | `cinemas.value = res.data` |
| **R – Lekérés** | `fetchCinema(id)` | GET | `/:id` | `id` | `selectedCinema` | – |
| **C – Létrehozás** | `createCinema(dto)` | POST | `/` | `name, location …` | `cinemas.push` | – |
| **U – Frissítés** | `updateCinema(id,dto)` | PUT | `/:id` | `id, dto` | splice / `selectedCinema` | – |
| **D – Törlés** | `deleteCinema(id)` | DELETE | `/:id` | `id` | `cinemas = filter` | – |

```mjs
  async function deleteCinema(id: number) {
    try {
      loading.value = true
      await api.delete(`${base}/${id}`)
      cinemas.value = cinemas.value.filter(c => c.id !== id)
    } catch (e) {
      error.value = parseError(e)
    } finally {
      loading.value = false
    }
  }
```

## 5 | Hiba- és töltéskezelés

- **Konzolos naplózás:** minden akció `console.error`-t hív magyar nyelvű üzenettel.

* Minden akció `try / catch / finally` blokkban fut.  
* A `loading` jelző minden API-hívás elején `true`, végén `false`.  
* A komponensek `v-if="error"` segítségével jelenítenek meg toastot / alertet.

## 6 | Vue-Router guard (előbetöltés)

```mjs
// router.mjs
import { useDriveInCinemaStore } from '@/stores/driveInCinema'

router.beforeEach(async (to) => {
  if (to.name === 'Screening' && to.params.id) {
    const store = useDriveInCinemaStore()
    await store.fetchCinema(Number(to.params.id))
  }
})
```

Előnyei:  
• A `Screening` komponens már kész adatokkal renderel.  
• Hibát dob, ha a mozi nem létezik → 404 route-ra irányíthatunk.

## 7 | Tesztelés

### 7.1 Unit teszt (Vitest + axios-mock)

```mjs
import { setActivePinia, createPinia } from 'pinia'
import { useDriveInCinemaStore } from '@/stores/driveInCinema'
import mockAxios from 'axios-mock-adapter'
import axios from 'axios'

describe('useDriveInCinemaStore', () => {
  const mock = new mockAxios(axios)

  beforeEach(() => {
    setActivePinia(createPinia())
  })

  it('fetches list', async () => {
    mock.onGet('/api/drive-in-cinemas').reply(200, [{ id: 1, name: 'Sunset' }])
    const s = useDriveInCinemaStore()
    await s.fetchCinemas()
    expect(s.cinemas).toHaveLength(1)
  })
})
```

### 7.2 Laravel feature teszt

```php
public function test_can_create_cinema(): void
{
    $payload = ['name' => 'Sunset', 'location' => 'Budapest', 'capacity' => 100];
    $this->postJson('/api/drive-in-cinemas', $payload)
         ->assertCreated()
         ->assertJsonFragment($payload);
}
```

### 7.3 E2E (SeleniumIDE ‑ rövid - End-to-End)

1. **navigate** `/`
2. **click** „Új mozi”
3. **type** név, helyszín, kapacitás
4. **assert** lista rekord +1

## 8 | API útvonalak (Laravel `api.php`)

| Metódus | URI | Controller@Módszer |
|---------|-----|--------------------|
| GET     | `/drive-in-cinemas` | `index` |
| POST    | `/drive-in-cinemas` | `store` |
| GET     | `/drive-in-cinemas/{id}` | `show` |
| PUT     | `/drive-in-cinemas/{id}` | `update` |
| DELETE  | `/drive-in-cinemas/{id}` | `destroy` |

## 9 | Jövőbeli bővítések
- **Képfeltöltés** drive-in mozikhoz (S3 / Laravel MediaLibrary).  
- **Geo-search**: közeli mozik távolság szerint.  
- **Soft-delete + visszaállítás** admin felületen.  
- **Pagináció & szerver-oldali keresés** nagyméretű listához.  

---