# Purchase Model

A Purchase modell a vásárlások adatait tárolja és kezeli az adatbázisban. Ez a dokumentáció részletesen bemutatja a Purchase modell felépítését, funkcióit és kapcsolatait más modellekkel.

## Adatbázis Séma

A Purchase modell a `purchases` táblában kerül tárolásra az adatbázisban. A tábla a következő oszlopokat tartalmazza:

- `id` (bigint, unsigned): A vásárlás egyedi azonosítója, egyben a tábla elsődleges kulcsa.
- `screening_id` (bigint, unsigned): A vásárláshoz tartozó vetítés idegenkulcsa. Kötelező mező.
- `location_id` (bigint, unsigned): A vásárláshoz tartozó helyszín idegenkulcsa. Kötelező mező.
- `movie_id` (bigint, unsigned): A vásárláshoz tartozó film idegenkulcsa. Kötelező mező.
- `user_id` (bigint, unsigned, nullable): A vásárláshoz tartozó felhasználó idegenkulcsa. Opcionális mező.
- `ticket_code` (string, nullable): A vásárláshoz tartozó jegykód. Opcionális mező.
- `guest_email` (string, nullable): A vásárláshoz tartozó vendég e-mail címe. Opcionális mező.
- `parkingspot` (string, nullable): A vásárláshoz tartozó parkolóhely azonosítója. Opcionális mező.
- `created_at` (timestamp): A rekord létrehozásának időpontja. Automatikusan kezeli a Laravel.
- `updated_at` (timestamp): A rekord utolsó módosításának időpontja. Automatikusan kezeli a Laravel.

## Modell Osztály

A Purchase modell az `App\Models\Purchase` névtérben található. A modell a következő tulajdonságokkal és metódusokkal rendelkezik:

- `$table`: A modellhez kapcsolódó adatbázistábla neve (`purchases`).
- `$fillable`: A modellen keresztül tömegesen hozzárendelhető attribútumok tömbje:  
  `['location_id', 'screening_id', 'movie_id', 'ticket_code', 'guest_email', 'parkingspot', 'user_id', 'created_at', 'updated_at']`.
- `movie()`: 1:1 (BelongsTo) kapcsolatot definiál a Movie modellel. Egy vásárlás egy filmhez tartozik.
- `screening()`: 1:1 (BelongsTo) kapcsolatot definiál a Screening modellel. Egy vásárlás egy vetítéshez tartozik.
- `location()`: 1:1 (BelongsTo) kapcsolatot definiál a DriveinCinema modellel. Egy vásárlás egy helyszínhez tartozik.
- `user()`: 1:1 (BelongsTo) kapcsolatot definiál a User modellel. Egy vásárlás egy felhasználóhoz tartozhat.

## Adatbázis Migráció

A `purchases` tábla létrehozását a megfelelő adatbázis migráció végzi. A migráció a `database/migrations` könyvtárban található, és a következő metódusokat tartalmazza:

- `up()`: Létrehozza a `purchases` táblát a megadott oszlopokkal az adatbázisban.
- `down()`: Eltávolítja a `purchases` táblát az adatbázisból, ha a migráció visszavonásra kerül.

## Adatbázis Seeder

A `PurchaseSeeder` osztály (`database/seeders/PurchaseSeeder.php`) felelős a `purchases` tábla kezdeti adatokkal való feltöltéséért. A `run()` metódusban legalább egy minta vásárlás (`PurchaseFactory` segítségével) kerül feltöltésre. Ez a minta adat a seeder futtatásakor kerül be az adatbázisba.

## Erőforrás (Resource) Osztály

A `PurchaseResource` osztály (`app/Http/Resources/PurchaseResource.php`) a Purchase modell példányainak JSON reprezentációját alakítja át. A `toArray()` metódus definiálja, hogy a Purchase modell mely attribútumai kerüljenek bele a JSON válaszba, beleértve az `id`, `screening_id`, `location_id`, `movie_id`, `user_id`, `ticket_code`, `guest_email`, `parkingspot`, `created_at` és `updated_at` mezőket.

## Controller

A `PurchaseController` (`app/Http/Controllers/PurchaseController.php`) kezeli a Purchase modellel kapcsolatos HTTP kéréseket. A következő metódusokat tartalmazza:

- `index()`: Lekérdezi az összes vásárlást és `PurchaseResource` kollekcióként adja vissza őket.
- `store()`: Új vásárlás létrehozása a kérésben kapott adatok alapján.
- `show()`: Egy adott vásárlás lekérdezése azonosító alapján és `PurchaseResource`-ként való visszaadása.
- `update()`: Egy adott vásárlás adatainak frissítése a kérésben kapott adatok alapján.
- `destroy()`: Egy adott vásárlás törlése az adatbázisból.

A kontroller a kérések validálásához a `StorePurchaseRequest` és `UpdatePurchaseRequest` form request osztályokat használja.

## Kapcsolódó Modellek

A Purchase modell kapcsolatban áll a következő modellekkel:

- **Movie**: Egy vásárlás egy filmhez tartozik (`purchase->movie`).
- **Screening**: Egy vásárlás egy vetítéshez tartozik (`purchase->screening`).
- **Location**: Egy vásárlás egy helyszínhez tartozik (`purchase->location`).
- **User**: Egy vásárlás egy felhasználóhoz tartozhat (`purchase->user`).

## Konklúzió

A Purchase modell kulcsfontosságú szerepet tölt be a vásárlások adatainak tárolásában és kezelésében. A modell, a hozzá kapcsolódó migráció, seeder, erőforrás osztály és kontroller együttesen biztosítják a vásárlások perzisztens tárolását, lekérdezését, létrehozását, módosítását és törlését az alkalmazásban.

## Megjegyzés

A ***user_id*** vagy ***guest_email*** mezők közül az egyiknek kötelező kitöltve lennie. Eképpen kezeli a termékünk, hogy bejelentkezett felhasználóról, vagy vendégről van szó.