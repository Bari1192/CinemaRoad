# `ScreeningStore` – Pinia Store Dokumentáció

## Tartalomjegyzék
1. Áttekintés  
2. Függőségek  
3. Állapot (State)  
4. CRUD Akciók részletesen  
5. Hibakezelés  
6. Használati minták a komponensekben  
7. Kapcsolódó API-végpontok  
8. További fejlesztési ötletek  

---

## 1. Áttekintés
A `useScreeningStore` egy **Pinia** Composition API alapú áruház, amely a vetítések ( *screenings* ) lekérdezését és módosítását végzi a Laravel back-end REST API segítségével.  
Az áruház:

- két reaktív állapotot tart fenn (`screenings`, `screening`);

- teljes körű **CRUD** műveleteket biztosít (`getScreenings`, `getScreening`, `createScreening`, `updateScreening`, `deleteScreening`);

- egységes hibakezelést valósít meg `try/catch` blokkokkal.

```mjs
    import { ref } from 'vue'
    import { http } from '@utils/http.mjs'

    export const useScreeningStore = defineStore('screenings', ()     => {
      const screenings = ref([])
      const screening  = ref(null)

      async function getScreenings()
      async function getScreening(id)
      async function createScreening(data)
      async function updateScreening(id, data)
      async function deleteScreening(id)

      return {
        screenings, screening,
        getScreenings, getScreening,
        createScreening, updateScreening, deleteScreening
      }
    })
```

---

## 2. Függőségek
| Csomag | Verzió | Szerep |
|--------|--------|--------|
| `pinia` | ^2.x | Állapotkezelés |
| `vue`   | ^3.x | Composition API |
| `@utils/http.mjs` | Projekt-lokális | Axios-os HTTP wrapper (alapértelmezett JSON, `Authorization` header, stb.) |

---

## 3. Állapotok (State-ek)
| Változó | Típus | Kezdeti érték | Rendeltetés |
|---------|-------|--------------|-------------|
| `screenings` | `Ref<Array<Screening>>` | `[]` | A teljes vetítési lista |
| `screening`  | `Ref<Screening \| null>` | `null` | Az aktuálisan megjelenítendő/-szerkesztendő vetítés |

---

## 4. CRUD Akciók részletesen

| Függvény | HTTP | API útvonal | Visszatérés | Oldali állapot frissítés |
|----------|------|-------------|-------------|--------------------------|
| `getScreenings()` | GET | `/api/screenings` | `Screening[]` | `screenings = resp.data` |
| `getScreening(id)` | GET | `/api/screenings/{id}` | `Screening` | `screening = resp.data.data` |
| `createScreening(data)` | POST | `/api/screenings` | Létrehozott entitás | Push a `screenings` tömbbe |
| `updateScreening(id, data)` | PUT | `/api/screenings/{id}` | Módosított entitás | Újrabetölti a teljes listát |
| `deleteScreening(id)` | DELETE | `/api/screenings/{id}` | — | Szűrés a `screenings` tömbből |

### Részletes kódok

```mjs
async function getScreenings () {
  try {
    const resp = await http.get('/api/screenings')
    screenings.value = resp.data
  } catch (err) {
    console.error('Hiba a vetítések lekérésekor', err)
    throw err
  }
}
```

## 5. Hibakezelés
- **Konzolos naplózás:** minden akció `console.error`-t hív magyar nyelvű üzenettel.

- **Hiba továbbdobása:** `throw err` – lehetővé teszi, hogy a komponens szintjén `try/catch`-ben megjelenítsünk toastot vagy redirectet.

---

### Új vetítés létrehozása

```mjs
const { createScreening } = useScreeningStore()
await createScreening({
  movie_id: 3,
  screen_id: 2,
  start_time: '2025-07-01 21:00'
})
```

---

## 6. Kapcsolódó API-végpontok (Laravel Controller)

| Módszer | Útvonal | Controller metódus |
|---------|---------|--------------------|
| GET    | `/api/screenings`          | `ScreeningController@index` |
| GET    | `/api/screenings/{id}`     | `ScreeningController@show` |
| POST   | `/api/screenings`          | `ScreeningController@store` |
| PUT    | `/api/screenings/{id}`     | `ScreeningController@update` |
| DELETE | `/api/screenings/{id}`     | `ScreeningController@destroy` |

---

## 8. További fejlesztési ötletek

1. **Optimista törlés** helyett *undo* lehetőséggel.  

2. **Paginated** listák (`page`, `perPage`) támogatása.  

3. **Loading/error** állapot jelzők (`isLoading`, `errorMessage`) a UI jobb visszajelzéséért.  

4. **Vue-Router guard**: a `screening` előbetöltése route paraméter alapján.  

5. **Unit- és e2e-tesztek**: Pinia mocking + Laravel Feature tesztek.

---