# A Reservation Model

A `Reservation` modell az egyes *foglalásokat* kezeli az adatbázisban, beleértve a **felhasználó, vetítés, helyszín és a parkolóhely adatait**. Ez a dokumentáció részletesen bemutatja a modell felépítését, attribútumait, kapcsolatait és működését az alkalmazásban.

---

## Adatbázis Séma

A `Reservation` modell a `reservations` táblában kerül tárolásra az adatbázisban. A tábla a következő oszlopokat tartalmazza:

- `id` (bigint, unsigned): A foglalás egyedi azonosítója, elsődleges kulcs.
- `user_id` (foreignId): A foglalást létrehozó felhasználó azonosítója, kapcsolódik a `users` táblához.
- `screening_id` (foreignId): A foglalás vetítésének azonosítója, kapcsolódik a `screenings` táblához.
- `location_id` (foreignId): A foglalás helyszínének azonosítója, kapcsolódik a `drive_in_cinemas` táblához.
- `parkingspot` (string, 100): A lefoglalt parkolóhely(ek) azonosítója. Több hely esetén vesszővel elválasztva tárolható (`"A1,A2"`).
- `reserved_at` (datetime): A foglalás kezdő időpontja (amikor a vetítés megkezdődik).
- `created_at` (timestamp): Rekord létrehozásának ideje. Automatikusan kezeli a Laravel.
- `updated_at` (timestamp): Rekord utolsó módosításának ideje. Automatikusan kezeli a Laravel.

---

## Modell Osztály

A `Reservation` modell az `App\Models\Reservation` névtérben található. A modell a következő tulajdonságokkal és metódusokkal rendelkezik:

- `$table`: A modellhez kapcsolódó adatbázistábla neve (`reservations`).
- `$fillable`: Tömeges hozzárendelhető attribútumok: `user_id`, `screening_id`, `location_id`, `reserved_at`, `parkingspot`.
- `$timestamps`: Jelzi, hogy a modell használ időbélyegeket (`true`).
- `screening()`: Egy-a-többhöz (BelongsTo) kapcsolat a `Screening` modellel.
- `location()`: Egy-a-többhöz (BelongsTo) kapcsolat a `DriveInCinema` modellel.
- `user()`: Egy-a-többhöz (BelongsTo) kapcsolat a `User` modellel.

---

## Adatbázis Migráció

A `reservations` tábla létrehozását a megfelelő migráció kezeli (`database/migrations`).  
Főbb metódusok:

- `up()`: Létrehozza a tábla oszlopaival, ideértve a külső kulcsokat (`user_id`, `screening_id`, `location_id`), a parkolóhelyet és a foglalás időpontját.
- `down()`: Eltávolítja a `reservations` táblát, ha a migráció visszavonásra kerül.

**Megjegyzés:** A migráció jelenleg nem tiltja, hogy ugyanarra a parkolóhelyre többször foglaljanak ugyanazon vetítésre, ezt az üzleti logikában kell kezelni.

---

## Erőforrás (Resource) Osztály

A `ReservationResource` (`app/Http/Resources/ReservationResource.php`) felelős a `Reservation` objektumok JSON reprezentációjáért.  
A `toArray()` metódusban definiáljuk, hogy az alábbi mezők kerüljenek a JSON válaszba:

- `id`
- `user_id`
- `screening_id`
- `location_id`
- `parkingspot`
- `reserved_at`
- `created_at`
- `updated_at`
- Kapcsolt modellek betöltve: `user`, `screening.movie`, `screening.driveInCinema`, `location`

---

## Controller

A `ReservationsController` (`app/Http/Controllers/ReservationsController.php`) kezeli a foglalásokkal kapcsolatos HTTP kéréseket. Főbb metódusok:

- `index()`: Lekéri az összes foglalást, `ReservationResource` kollekcióként adja vissza.
- `store()`: Új foglalás létrehozása a `StoreReservationRequest` által validált adatok alapján. Ellenőrzi a foglalás logikát (pl. ütköző parkolóhelyek).
- `show()`: Egy adott foglalás lekérése azonosító alapján.
- `update()`: Létezik, de nem minden esetben használjuk (pl. admin módosítás).
- `destroy()`: Foglalás törlése.

---

## Kapcsolódó Modellek

- **User**: Minden foglalás kapcsolódik egy felhasználóhoz (`user()`).
- **Screening**: Minden foglalás kapcsolódik egy vetítéshez (`screening()`).
- **DriveInCinema**: Minden foglalás kapcsolódik egy helyszínhez (`location()`).

---

## Üzleti logika

- Egy parkolóhely egyszerre csak egy foglaláshoz tartozhat adott vetítéshez (`parkingspot` ellenőrzése).
- Több parkolóhely egy foglaláson belül tömörítve lehet tárolva (`"A1,A2,A3"`), így foglalásonként egy e-mail generálódik.
- Validáció a `StoreReservationRequest`-ben biztosítja a kötelező mezők meglétét és formátumát.

---

## Összefoglaló

A `Reservation` modell kulcsszerepet tölt be a drive-in foglalások kezelésében.  
A modell, migráció, resource osztály és controller együtt biztosítják, hogy:

- Foglalások létrehozása és lekérése stabilan működjön.  
- Kapcsolatok a felhasználókkal, vetítésekkel és helyszínekkel megfelelőek legyenek.  
- Az üzleti szabályok (pl. parkolóhely ütközés) betartásra kerüljenek.  
